version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: build   # ðŸ”¹ change if using Next.js (.next) or Vue (dist)
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
backend:
  phases:
    preBuild:
      commands:
        - sam --version   # just to confirm SAM is available in logs
        - cd auth         # ðŸ”¹ remove if your SAM template is at repo root
        - npm install
        - cd ..
    build:
      commands:
        - sam build
        - sam deploy --no-confirm-changeset --no-fail-on-empty-changeset \
          --stack-name amplify-auth-backend \
          --s3-bucket ${DEPLOYMENT_BUCKET_NAME} \
          --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM \
          --parameter-overrides Stage=${STAGE}
  artifacts:
    baseDirectory: .
    files:
      - '**/*'

