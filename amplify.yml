version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: build   # change to .next, dist, or your frontend output dir
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
backend:
  phases:
    preBuild:
      commands:
        - npm install -g aws-sam-cli
        - cd auth
        - npm install
        - cd ..
    build:
      commands:
        - sam build
        - sam deploy --no-confirm-changeset --no-fail-on-empty-changeset \
          --stack-name amplify-auth-backend \
          --s3-bucket ${DEPLOYMENT_BUCKET_NAME} \
          --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM \
          --parameter-overrides Stage=${STAGE}
  artifacts:
    baseDirectory: .
    files:
      - '**/*'
